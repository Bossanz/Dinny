<div class="flex h-screen bg-bg">
  <app-sidebar></app-sidebar>

  <main class="flex-1 p-10 flex flex-col">
    <div class="bg-white rounded-2xl shadow-md p-6 flex flex-col gap-6 flex-1">
      
      <!-- Header -->
      <div class="flex justify-between items-center">
        <h2 class="text-2xl font-semibold">
          คำสั่งซื้อของ {{ personType | titlecase }} ID: {{ personId }}
        </h2>
        <button (click)="goBack()" class="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300">
          ← กลับ
        </button>
      </div>

      <!-- Month selector -->
      <div class="flex items-center gap-4">
        <label class="font-medium">เลือกเดือน:</label>
        <input
          type="month"
          [(ngModel)]="selectedMonth"
          (change)="fetchOrders()"
          class="rounded-lg px-3 py-2 border text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500"
        />
      </div>

      <!-- Table container with vertical scroll -->
      <div *ngIf="loading" class="text-gray-500 mt-2">Loading...</div>

      <div *ngIf="!loading && orders.length" class="flex-1 overflow-auto border border-gray-200 rounded">
        <table class="w-full min-w-[700px] table-auto">
          <thead class="text-left text-sm text-gray-500 bg-gray-100 sticky top-0 z-10">
            <tr>
              <th class="py-3 px-4">Order ID</th>
              <th class="py-3 px-4">วันที่</th>
              <th class="py-3 px-4 text-right">รายได้ (บาท)</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let o of orders" class="border-t hover:bg-gray-50">
              <td class="py-2 px-4">{{ o.ord_id }}</td>
              <td class="py-2 px-4">{{ o.ord_date | date:'dd/MM/yyyy HH:mm' }}</td>
              <td class="py-2 px-4 text-right">{{ o.income | number:'1.0-2' }}</td>
            </tr>

            <!-- Total row -->
            <tr class="font-semibold border-t bg-gray-50 sticky bottom-0">
              <td class="py-2 px-4" colspan="2">รวมทั้งหมด</td>
              <td class="py-2 px-4 text-right">{{ getTotalIncome() | number:'1.0-2' }}</td>
            </tr>
          </tbody>
        </table>
      </div>

      <div *ngIf="!loading && orders.length === 0" class="text-gray-500 mt-4">
        ไม่มีคำสั่งซื้อในเดือนนี้
      </div>
    </div>
  </main>
</div>
